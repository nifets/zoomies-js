<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoomies.js - Gene Regulatory Network Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: rgba(0, 0, 0, 0.3);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 300;
        }

        main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background: white;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.1);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .controls {
            background: white;
            border-left: 1px solid #ddd;
            width: 280px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h3 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            color: #333;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            border: none;
            border-radius: 4px;
            background: #667eea;
            color: white;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background: #764ba2;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: scale(0.98);
        }

        .button-group {
            display: flex;
            gap: 8px;
        }

        .button-group button {
            flex: 1;
            margin: 0;
        }

        .info-box {
            background: #f5f5f5;
            border-left: 3px solid #667eea;
            padding: 12px;
            border-radius: 4px;
            font-size: 12px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 12px;
        }

        .info-box strong {
            color: #333;
        }

        .zoom-indicator {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            text-align: centre;
            font-size: 13px;
            margin-bottom: 12px;
        }

        .zoom-indicator .value {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
        }

        footer {
            background: rgba(0, 0, 0, 0.3);
            color: white;
            text-align: centre;
            padding: 15px;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .legend {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: centre;
            margin-bottom: 8px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .stats {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>üß¨ Zoomies.js - Gene Regulatory Network</h1>
        <p class="subtitle">Interactive hierarchical multi-scale graph visualization</p>
    </header>

    <main>
        <div class="canvas-container">
            <canvas id="graph-canvas"></canvas>
        </div>

        <div class="controls">
            <div class="zoom-indicator">
                Zoom Level:<br>
                <span class="value" id="zoom-level">0.00</span>
            </div>

            <div class="control-group">
                <h3>üéÆ Interactions</h3>
                <button onclick="zoomIn()">Zoom In</button>
                <button onclick="zoomOut()">Zoom Out</button>
                <button onclick="resetZoom()">Reset View</button>
            </div>

            <div class="control-group">
                <h3>‚öôÔ∏è Simulation</h3>
                <button onclick="togglePhysics()" id="physics-btn">Enable Physics</button>
                <button onclick="randomizeLayout()">Randomize Layout</button>
            </div>

            <div class="control-group">
                <h3>üìä Scene Info</h3>
                <div class="stats">
                    <div class="stat-row">
                        <strong>Nodes:</strong> <span id="node-count">0</span>
                    </div>
                    <div class="stat-row">
                        <strong>Edges:</strong> <span id="edge-count">0</span>
                    </div>
                    <div class="stat-row">
                        <strong>HyperEdges:</strong> <span id="hyperedge-count">0</span>
                    </div>
                    <div class="stat-row">
                        <strong>Modules:</strong> <span id="module-count">0</span>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3>üé® Legend</h3>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #3498db;"></div>
                        <span>Base Nodes (mRNA, Proteins)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #e74c3c;"></div>
                        <span>Implicit (Hidden)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #f39c12;"></div>
                        <span>Selected</span>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <strong>üí° Tip:</strong> Scroll to zoom in/out. Right-click modules to collapse/expand.
            </div>
        </div>
    </main>

    <footer>
        Zoomies.js ¬© 2025 ‚Äî Generic hierarchical graph visualization library for any domain
    </footer>

    <script type="module">
        import { Zoomies, Node, Edge, HyperEdge, Module } from './src/index.ts';

        let zoomies = null;

        // Create Level 0: base nodes (species and implicit catalysts)
        const mRNA_A = new Node('mRNA_A', { layer: 0, colour: '#3498db', radius: 10 });
        const mRNA_B = new Node('mRNA_B', { layer: 0, colour: '#3498db', radius: 10 });
        const protein_A = new Node('Protein_A', { layer: 0, colour: '#3498db', radius: 10 });
        const protein_B = new Node('Protein_B', { layer: 0, colour: '#3498db', radius: 10 });

        // Implicit nodes (not rendered)
        const ribosome = new Node('Ribosome', { layer: 0, implicit: true, visible: false });
        const tf_a = new Node('TF_A', { layer: 0, implicit: true, visible: false });

        // Level 0: Hyperedges (reactions)
        const transcription_a = new HyperEdge('transcription_A', [tf_a], [mRNA_A], {
            layer: 0,
            colour: '#9b59b6',
            width: 2
        });
        const translation_a = new HyperEdge('translation_A', [mRNA_A, ribosome], [protein_A], {
            layer: 0,
            colour: '#9b59b6',
            width: 2
        });
        const transcription_b = new HyperEdge('transcription_B', [], [mRNA_B], {
            layer: 0,
            colour: '#9b59b6',
            width: 2
        });
        const translation_b = new HyperEdge('translation_B', [mRNA_B, ribosome], [protein_B], {
            layer: 0,
            colour: '#9b59b6',
            width: 2
        });

        // Repression edge: Protein_B inhibits transcription_a
        const repression = new Edge('repression', protein_B, mRNA_A, {
            layer: 0,
            colour: '#e74c3c',
            width: 2
        });

        // Level 1: Gene modules
        const GeneA_Module = new Module('Gene_A', {
            children: [mRNA_A, protein_A],
            edges: [repression],
            hyperEdges: [transcription_a, translation_a],
            layer: 1,
            colour: '#ecf0f1',
            shape: 'rectangle',
            width: 80,
            height: 60,
            radius: 30,
            cornerRadius: 10
        });

        const GeneB_Module = new Module('Gene_B', {
            children: [mRNA_B, protein_B],
            edges: [],
            hyperEdges: [transcription_b, translation_b],
            layer: 1,
            colour: '#ecf0f1',
            shape: 'circle',
            radius: 40
        });

        // Level 1: Edge between gene modules (regulation between modules)
        const geneRegulation = new Edge('gene_regulation', GeneA_Module, GeneB_Module, {
            layer: 1,
            colour: '#f39c12',
            width: 2
        });

        // Position modules at different locations to separate genes
        GeneA_Module.setPosition(-150, -80);
        GeneB_Module.setPosition(150, -80);

        // Initialize Zoomies
        zoomies = new Zoomies('#graph-canvas', {
            nodes: [], // No top-level nodes - all are inside modules
            edges: [repression, geneRegulation],
            hyperEdges: [transcription_a, translation_a, transcription_b, translation_b],
            modules: [GeneA_Module, GeneB_Module],
            enablePhysics: true
        });

        // Update stats
        function updateStats() {
            document.getElementById('node-count').textContent = 
                zoomies.manager.nodes.filter(n => !n.implicit).length;
            document.getElementById('edge-count').textContent = zoomies.manager.edges.length;
            document.getElementById('hyperedge-count').textContent = zoomies.manager.hyperEdges.length;
            document.getElementById('module-count').textContent = zoomies.manager.modules.length;
            document.getElementById('zoom-level').textContent = zoomies.getZoom().toFixed(2);
        }

        // Update stats every frame
        const statsInterval = setInterval(updateStats, 100);

        // Event listeners
        window.zoomIn = () => zoomies.setZoom(zoomies.getZoom() + 0.5);
        window.zoomOut = () => zoomies.setZoom(zoomies.getZoom() - 0.5);
        window.resetZoom = () => zoomies.setZoom(0);

        let physicsEnabled = true;
        window.togglePhysics = () => {
            physicsEnabled = !physicsEnabled;
            if (physicsEnabled) {
                zoomies.enablePhysics();
                document.getElementById('physics-btn').textContent = 'Disable Physics';
            } else {
                zoomies.disablePhysics();
                document.getElementById('physics-btn').textContent = 'Enable Physics';
            }
        };

        window.randomizeLayout = () => {
            zoomies.manager.nodes.forEach(node => {
                node.x = Math.random() * 400 - 200;
                node.y = Math.random() * 400 - 200;
                node.vx = 0;
                node.vy = 0;
            });
            if (physicsEnabled) {
                zoomies.manager.physicsEngine.start();
            }
        };

        // Listen to interaction events
        zoomies.on('nodeSelected', (node) => {
            console.log('Node selected:', node.id);
        });

        zoomies.on('nodeHover', (node) => {
            console.log('Hovering:', node.id);
        });

        updateStats();
    </script>
</body>
</html>
